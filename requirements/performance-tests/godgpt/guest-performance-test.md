# 非登录用户性能压测需求

## 测试目标
验证系统在非登录用户（Guest）高并发场景下的性能表现，重点关注：
- `guest/create-session` 接口的稳定性和性能
- `guest/chat` 接口的稳定性和性能
- Kafka消息处理机制的稳定性，确保无消息积压
- 确定系统在非登录场景下的性能基线和容量上限

## 性能指标要求

| 指标 | 阈值 | 备注 |
|------|------|------|
| TPS (每秒事务数) | 通过压测确定 | 需要通过测试获得最大值 |
| 平均响应时间 | <= 200ms | 正常业务场景下的响应时间 |
| 错误率 | <= 0.1% | 错误率 |
| CPU使用率 | <= 80% | 系统CPU资源使用率 |
| 内存使用率 | <= 80% | 系统内存资源使用率 |
| Kafka消息堆积 | <= 1000 | 消息队列积压数量 |

## 测试场景设计

### 场景一：guest/create-session 接口压测

#### 1.1 基线测试
- **描述**：模拟 1 个用户，持续 1 分钟
- **目的**：确认接口在低负载下的正确性和性能基线
- **验证点**：
  - 接口功能正确性
  - 基础性能指标
  - 系统资源使用情况

#### 1.2 并发压力测试

##### 阶梯式递增测试
```
0 → 50用户（30s爬坡）→ 持续5分钟 
  → 100用户（30s爬坡）→ 持续5分钟 
  → 150用户（30s爬坡）→ 持续5分钟 
  → ...逐步递增至目标值
```

##### 瞬时压力测试
```
0 → 100用户瞬时加压 → 持续5分钟 → 骤降至0
0 → 200用户瞬时加压 → 持续5分钟 → 骤降至0
0 → 300用户瞬时加压 → 持续5分钟 → 骤降至0
...
```
- **目的**：模拟突发流量对系统的冲击

### 场景二：guest/chat 接口压测

#### 2.1 基线测试
- **描述**：模拟 1 个用户，持续 1 分钟
- **目的**：确认接口在低负载下的正确性和性能基线
- **验证点**：
  - 接口功能正确性
  - 会话创建和对话的完整流程
  - 基础性能指标

#### 2.2 并发压力测试

##### 阶梯式递增测试
```
0 → 50用户（30s爬坡）→ 持续5分钟 
  → 100用户（30s爬坡）→ 持续5分钟 
  → 150用户（30s爬坡）→ 持续5分钟 
  → ...逐步递增至目标值
```

##### 瞬时压力测试
```
0 → 100用户瞬时加压 → 持续5分钟 → 骤降至0
0 → 200用户瞬时加压 → 持续5分钟 → 骤降至0
0 → 300用户瞬时加压 → 持续5分钟 → 骤降至0
...
```

## 监控要点

### 系统监控
- CPU使用率
- 内存使用率
- 网络I/O
- 磁盘I/O

### 应用监控
- 接口响应时间
- 接口成功率
- 错误率统计
- 并发连接数

### 中间件监控
- Kafka消息队列长度
- 消息处理速度
- 消息积压情况

## 测试数据要求
- 测试消息内容应模拟真实用户对话
- 消息长度应覆盖短、中、长三种场景
- 测试数据应具有随机性，避免缓存影响